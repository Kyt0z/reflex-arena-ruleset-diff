<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ruleset Comparison tool by Kyto</title>
	<style type="text/css">
		* {
			box-sizing: border-box;
		}

		body {
			background-color: #282923;
			color: #f8f8f2;
			font-family: monospace;
			font-size: 12px;
			padding-bottom: 200px;
		}

		#difftable {
			border: solid 2px #403d32;
			border-collapse: collapse;
		}

		#difftable th {
			border: solid 2px #403d32;
			text-align: left;
		}

		#difftable td {
			border: dotted 1px #403d32;
		}

		#difftable .bottom {
			border-bottom: solid 1px #403d32;
		}

		#difftable .variable {
			border-right: solid 1px #403d32;
		}

		.variable {
			color: #e7db74;
		}

		.negative {
			color: #f92472;
		}

		.positive {
			color: #a6e22b;
		}
	</style>
	<script type="text/javascript">
		const gconst = [
			// general
			"gconst_default_game_timelimit",
			"gconst_expose_timers_to_lua",
			"gconst_powerups_drop",
			// movement/physics
			"gconst_player_isbullet",
			"gconst_double_jump_velocity",
			"gconst_jump_velocity",
			"gconst_playerinair_acceleration",
			"gconst_playerinair_aircontrol",
			"gconst_playerinair_bunny_accelerate",
			"gconst_playerinair_bunny_wishspeed",
			"gconst_playerinair_decceleration",
			"gconst_playerinaircrouched_acceleration",
			"gconst_playeronground_acceleration",
			"gconst_playeronground_friction",
			"gconst_playeronground_speed",
			"gconst_playerongroundcrouched_speed",
			"gconst_wallclipping",
			"gconst_world_gravity",
			// sound
			"gconst_armor100_faratten",
			"gconst_armor150_faratten",
			"gconst_armor50_faratten",
			"gconst_mega_faratten",
			// melee
			"gconst_melee_damage",
			"gconst_melee_knockmult",
			"gconst_melee_knockmult_airbourne",
			"gconst_melee_range",
			"gconst_melee_reload",
			"gconst_melee_trace_radius",
			// burst gun
			"gconst_burst_damage",
			"gconst_burst_knockmult",
			"gconst_burst_knockmult_airbourne",
			"gconst_burst_speed",
			"gconst_burstgun_ammopickupammo",
			"gconst_burstgun_burstsegments",
			"gconst_burstgun_lowammo",
			"gconst_burstgun_maxammo",
			"gconst_burstgun_reload",
			"gconst_burstgun_startammo",
			"gconst_burstgun_weaponpickupammo",
			// shotgun
			"gconst_shotgun_pellet_damage",
			"gconst_shotgun_pellet_knockmult",
			"gconst_shotgun_pellet_knockmult_airbourne",
			"gconst_shotgun_pellet_range",
			"gconst_shotgun_pellet_trace_radius_entities",
			"gconst_shotgun_pellet_trace_radius_world",
			"gconst_shotgun_ammopickupammo",
			"gconst_shotgun_lowammo",
			"gconst_shotgun_maxammo",
			"gconst_shotgun_reload",
			"gconst_shotgun_weaponpickupammo",
			// grenades
			"gconst_grenade_damage",
			"gconst_grenade_damage_splashmult",
			"gconst_grenade_explosion_radius",
			"gconst_grenade_gravity",
			"gconst_grenade_speed_initial",
			"gconst_grenade_trace_radius_entities",
			"gconst_grenade_trace_radius_world",
			"gconst_grenadelauncher_ammopickupammo",
			"gconst_grenadelauncher_lowammo",
			"gconst_grenadelauncher_maxammo",
			"gconst_grenadelauncher_reload",
			"gconst_grenadelauncher_weaponpickupammo",
			// plasma
			"gconst_cell_damage",
			"gconst_cell_damage_splashmult",
			"gconst_cell_explosion_radius",
			"gconst_cell_knockmult",
			"gconst_cell_knockmult_airbourne",
			"gconst_cell_knockmult_self",
			"gconst_cell_trace_radius_entities",
			"gconst_cell_trace_radius_world",
			"gconst_plasmarifle_ammopickupammo",
			"gconst_plasmarifle_lowammo",
			"gconst_plasmarifle_maxammo",
			"gconst_plasmarifle_reload",
			"gconst_plasmarifle_weaponpickupammo",
			// rockets
			"gconst_rocket_damage",
			"gconst_rocket_damage_splashmult",
			"gconst_rocket_explosion_radius",
			"gconst_rocket_knockmult",
			"gconst_rocket_knockmult_airbourne",
			"gconst_rocket_knockmult_self",
			"gconst_rocket_speed",
			"gconst_rocket_trace_radius_entities",
			"gconst_rocket_trace_radius_world",
			"gconst_rocketlauncher_ammopickupammo",
			"gconst_rocketlauncher_lowammo",
			"gconst_rocketlauncher_maxammo",
			"gconst_rocketlauncher_reload",
			"gconst_rocketlauncher_weaponpickupammo",
			// ion cannon
			"gconst_beam_damage",
			"gconst_beam_distance",
			"gconst_beam_knockmult",
			"gconst_beam_knockmult_airbourne",
			"gconst_beam_trace_radius_entities",
			"gconst_beam_trace_radius_world",
			"gconst_ioncannon_ammopickupammo",
			"gconst_ioncannon_hum",
			"gconst_ioncannon_hum_faratten",
			"gconst_ioncannon_lowammo",
			"gconst_ioncannon_maxammo",
			"gconst_ioncannon_reload",
			"gconst_ioncannon_weaponpickupammo",
			// bolt rifle
			"gconst_bolt_damage",
			"gconst_bolt_knockmult",
			"gconst_bolt_knockmult_airbourne",
			"gconst_bolt_range",
			"gconst_bolt_trace_radius_entities",
			"gconst_bolt_trace_radius_world",
			"gconst_boltrifle_ammopickupammo",
			"gconst_boltrifle_hum",
			"gconst_boltrifle_hum_faratten",
			"gconst_boltrifle_lowammo",
			"gconst_boltrifle_maxammo",
			"gconst_boltrifle_reload",
			"gconst_boltrifle_weaponpickupammo",
			// stake
			"gconst_stake_damage",
			"gconst_stake_gravity",
			"gconst_stake_knockmult",
			"gconst_stake_knockmult_airbourne",
			"gconst_stake_radius",
			"gconst_stake_speed",
			"gconst_stake_trace_radius",
			"gconst_stakelauncher_ammopickupammo",
			"gconst_stakelauncher_enabled",
			"gconst_stakelauncher_lowammo",
			"gconst_stakelauncher_maxammo",
			"gconst_stakelauncher_reload",
			"gconst_stakelauncher_weaponpickupammo"
		];

		const bottoms = ["gconst_powerups_drop", "gconst_world_gravity", "gconst_mega_faratten", "gconst_melee_trace_radius", "gconst_burstgun_weaponpickupammo", "gconst_shotgun_weaponpickupammo", "gconst_grenadelauncher_weaponpickupammo", "gconst_plasmarifle_weaponpickupammo", "gconst_rocketlauncher_weaponpickupammo", "gconst_ioncannon_weaponpickupammo", "gconst_boltrifle_weaponpickupammo", "gconst_stakelauncher_weaponpickupammo"];

		function parseRuleset(rulesetStr)
		{
			let ruleset = {};
			for(let line of rulesetStr.split("\n"))
			{
				line = line.trim();
				if(line.length > 0 && line.substring(0, 2) != "//")
				{
					line = line.split(" ");
					ruleset[line[0]] = line[1];
				}
			}
			return ruleset;
		}

		function countDecimals(num)
		{
			const numStrs = num.toString().split(".");
			if(numStrs.length < 2)
				return 0;
			return numStrs[1].length;
		}

		function compareFiles()
		{
			const fileInput1 = document.getElementById("ruleset1").files[0];
			const fileInput2 = document.getElementById("ruleset2").files[0];

			if(!fileInput1 || !fileInput2)
				return;

			document.getElementById("rulesetName1").innerText = fileInput1.name.replace(".cfg", "");
			document.getElementById("rulesetName2").innerText = fileInput2.name.replace(".cfg", "");

			const reader1 = new FileReader();
			const reader2 = new FileReader();
			reader1.onload = function(event)
			{
				const ruleset1 = parseRuleset(event.target.result);
				reader2.onload = function(event)
				{
					const ruleset2 = parseRuleset(event.target.result);

					const convertToNumbers = document.getElementById("convertToNumbers").checked;
					const roundNumbers = document.getElementById("roundNumbers").checked;
					for(const gconstVar of gconst)
					{
						const diffCell = document.getElementById(`diff_${gconstVar}`);
						diffCell.classList.remove("negative", "positive");
						diffCell.innerText = "";

						let gconstNum1 = ruleset1[gconstVar];
						let gconstNum2 = ruleset2[gconstVar];
						let diffValue = Number(gconstNum2) - Number(gconstNum1);
						if(convertToNumbers)
						{
							gconstNum1 = Number(gconstNum1);
							gconstNum2 = Number(gconstNum2);
							if(roundNumbers)
							{
								const decimals = Math.max(countDecimals(gconstNum1), countDecimals(gconstNum2));
								gconstNum1 = gconstNum1.toFixed(decimals);
								gconstNum2 = gconstNum2.toFixed(decimals);
								diffValue = diffValue.toFixed(decimals);
							}
							document.getElementById(`ruleset1_${gconstVar}`).innerText = (gconstVar in ruleset1) ? gconstNum1 : "";
							document.getElementById(`ruleset2_${gconstVar}`).innerText = (gconstVar in ruleset2) ? gconstNum2 : "";
						}
						else
						{
							document.getElementById(`ruleset1_${gconstVar}`).innerText = ruleset1[gconstVar];
							document.getElementById(`ruleset2_${gconstVar}`).innerText = ruleset2[gconstVar];
						}

						if(!Number.isNaN(diffValue))
						{
							if(diffValue > 0)
							{
								diffCell.classList.add("positive");
								diffCell.innerText = `+${diffValue}`;
							}
							else if(diffValue < 0)
							{
								diffCell.classList.add("negative");
								diffCell.innerText = diffValue;
							}
						}
					}
				};
				reader2.readAsText(fileInput2);
			};
			reader1.readAsText(fileInput1);
		}
	</script>
</head>
<body>
	<div style="display: flex;">
		<div style="">
			<strong>Ruleset 1</strong>
			<br>
			<input type="file" accept=".cfg" id="ruleset1">
			<br>
			<br>
			<strong>Ruleset 2</strong>
			<br>
			<input type="file" accept=".cfg" id="ruleset2">
		<div style="">
			<br>
			<label><input type="checkbox" id="convertToNumbers" name="convcheck" checked> Convert to numbers</label>
			<br>
			<label><input type="checkbox" id="roundNumbers" name="roundcheck" checked> Round numbers</label>
			<br>
			<br>
			<button onclick="compareFiles()">Compare</button>
		</div>
	</div>
	<div>
		<table id="difftable">
			<tr>
				<th>Variable</th>
				<th id="rulesetName1">Ruleset 1</th>
				<th id="rulesetName2">Ruleset 2</th>
				<th>Change</th>
			</tr>
		</table>
	</div>
	<script type="text/javascript">
		(function()
		{
			for(const gconstVar of gconst)
			{
				const row = document.createElement("tr");

				const variableCell = document.createElement("td");
				variableCell.innerText = gconstVar;
				variableCell.classList.add("variable");

				const valueCell1 = document.createElement("td");
				valueCell1.id = `ruleset1_${gconstVar}`;

				const valueCell2 = document.createElement("td");
				valueCell2.id = `ruleset2_${gconstVar}`;

				const diffCell = document.createElement("td");
				diffCell.id = `diff_${gconstVar}`;

				if(bottoms.includes(gconstVar))
				{
					variableCell.classList.add("bottom");
					valueCell1.classList.add("bottom");
					valueCell2.classList.add("bottom");
					diffCell.classList.add("bottom");
				}

				row.appendChild(variableCell);
				row.appendChild(valueCell1);
				row.appendChild(valueCell2);
				row.appendChild(diffCell);

				document.getElementById("difftable").appendChild(row);
			}
		}
		)();
	</script>
</body>
</html>